---
title: 'DOB+MPC Simulation (Quadrotor Delivery)'
date: 2024-01-21
permalink: /posts/2024/01/DOB_MPC/simulation_Quadrotor_Delivery
tags:
  - Control Theory
  - Disturbance Observer
  - DOB
  - Model Predictive Control
  - MPC
  - Quadrotor Delivery
  - Unmodeled Dynamics
  - Parametric Uncertainty
---

## DOB + MPC simulation (Quadrotor Delivery)

In this post, I'll present simulation results for DOB + MPC(Model Predictive Control), using the quadrotor dynamics. Recently, quadrotors are often used to deliver payloads such as food or medical devices to the rural areas. Various methods such as adaptive control are suggested to handle these uncertainties with disturbances. In this post, we explore the use of DOB as an add-on robust controller in conjunction with MPC.

## Why DOB+MPC?

Typically, MPC employs a linear state-space model and optimizes a quadratic cost function for a finite horizon in the future. The quality of the model significantly influences the prediction of the system behavior, especially for real-world MPC performance. To address this challenge, the concept of DOB comes into play, ensuring that the true dynamic model behaves similar to the nominal model. If DOB successfully makes the true system behavior just as the nominal model, it gives confidence in utilizing model-based algorithms like MPC.

## Quadrotor Dynamics with mass-spring-damper payload attached

<img src='/images/Blog_img/DOB_post/quad_payload.jpg' width='500'/>

For simplicity, I assumed that the mass-spring-damper payload dynamics only affect the z-dynamics of the quadrotor. Let the state variables of quadrotor dynamics as follows:
- $(x,y,z)$ : Position of the center of the gravity of the quadrotor
- $(z_c)$ : Position of the cargo in z coordinate
- $(\phi, \theta, \psi)$ : Roll, Pitch, Yaw angle of the quadrotor
- $(\dot{x}, \dot{y}, \dot{z})$ : Velocity of the quadrotor for each coordinate in earth-frame
- $(\dot{z}_c)$ : Velocity of the cargo in z coordinate
- $(\dot{\phi}, \dot{\theta}, \dot{\psi})$ : Angular velocity for each coordinate in body-frame

### Dynamical model of the quadrotor

The dynamical model of the quadrotor can be written as following equations:
- $\ddot{x} = (\cos\phi \sin\theta \cos \psi + \sin \phi \sin\psi)\frac{U_1}{m}$
- $\ddot{y} = (\cos\phi \sin\theta \sin \psi - \sin \phi \cos\psi)\frac{U_1}{m}$
- $\ddot{z} = -g+(\cos\phi \cos\theta)\frac{U_1}{m} + \frac{c}{m}(\dot{z_c}-\dot{z})-\frac{k_c}{m}(z-z_c)$
- $\ddot{z_c} = -g - \frac{c}{m_c}(\dot{z_c}-\dot{z})+\frac{k_c}{m_c}(z-z_c)$
- $\ddot{\phi} = \dot{\theta}\dot{\psi}(\frac{I_y-I_z}{I_x})+\frac{L}{I_x}U_2$
- $\ddot{\theta} = \dot{\phi}\dot{\psi}(\frac{I_z-I_x}{I_y})+\frac{L}{I_y}U_3$
- $\ddot{\psi} = \dot{\phi}\dot{\theta}(\frac{I_x-I_y}{I_z}) + \frac{1}{I_z}U_4$

where $m$ and $m_c$ is the mass of the quadrotor and the payload each. Also, $k_c$ denotes the spring constant of the payload, and $c$ denotes the damping constant of the equivalent mass-spring-damper system. $I_x, I_y, I_z$ represents the moments of inertia for each coordinate. Note that the mass-spring-damper system of payload was added to the z-dynamics. Here, air drag force and reaction forces from the propeller blades were ignored and treated as disturbances. For the simulation, we utilized the above dynamics as the true dynamics with the unknown parameters. 

### Simplified Dynamical model of the quadrotor

Since the dynamics are complex and coupled between each other, the well-known decoupling techniques were used to simplify the system. With the small angle approximation, we get the linearized dynamics of the quadrotor as follows:
